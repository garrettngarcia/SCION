(function(){if(!this.require){var e={},t={},n=function(s,o){var u=r(o,s),a=t[u],f;if(a)return a.exports;if(!(f=e[u]||e[u=r(u,"./index")]))throw"module '"+s+"' not found";a={id:u,exports:{}};try{return t[u]=a,f(a.exports,function(e){return n(e,i(u))},a),a.exports}catch(l){throw delete t[u],l}},r=function(e,t){var n=[],r,i;/^\.\.?(\/|$)/.test(t)?r=[e,t].join("/").split("/"):r=t.split("/");for(var s=0,o=r.length;s<o;s++)i=r[s],i==".."?n.pop():i!="."&&i!=""&&n.push(i);return n.join("/")},i=function(e){return e.split("/").slice(0,-1).join("/")};this.require=function(e){return n(e,"")},this.require.define=function(t){for(var n in t)e[n]=t[n]}}return this.require.define}).call(this)({"base-platform/dom":function(e,t,n){"use strict";n.exports={getChildren:function(e){return Array.prototype.slice.call(e.childNodes)},localName:function(e){return e.localName},getAttribute:function(e,t){return e.getAttribute(t)},hasAttribute:function(e,t){return e.hasAttribute(t)},namespaceURI:function(e){return e.namespaceURI},createElementNS:function(e,t,n){return e.createElementNS(t,n)},setAttribute:function(e,t,n){return e.setAttribute(t,n)},appendChild:function(e,t){return e.appendChild(t)},textContent:function(e,t){function r(e,t){var n;for(var i in e)n=t.ownerDocument.createElement("data"),n.setAttribute("id",i),typeof e[i]!="object"||e[i]instanceof Array?n.setAttribute("expr",e[i]):r(e[i],n),t.appendChild(n)}if(t===undefined)return e.nodeType===1?e.textContent!==undefined?e.textContent:this.getChildren(e).map(function(e){return this.textContent(e)},this).join(""):e.nodeType===3||e.nodeType===4?e.data:"";if(e.nodeType===1){if(e.textContent!==undefined)return typeof t=="object"?(r(t,e),e.removeAttribute("src"),t):e.textContent=t;var n=e.ownerDocument.createTextNode(t);return e.appendChild(n),t}if(e.nodeType===3)return e.data=t},getElementChildren:function(e){return this.getChildren(e).filter(function(e){return e.nodeType===1})}}},"base-platform/eval":function(exports,require,module){module.exports=function(content,name){return eval("(function(){\nreturn "+content+";})()")}},"base-platform/path":function(e,t,n){"use strict";n.exports={sep:"/",join:function(e,t){return e+"/"+t},dirname:function(e){return e.split(this.sep).slice(0,-1).join(this.sep)},basename:function(e,t){var n=e.split(this.sep).slice(-1);if(t){var r=this.extname(n);r[1]===t&&(n=r[1])}return n},extname:function(e){return e.split(/\\.(?=[^\\.]+$)/)[1]}}},"browser/browser-listener-client":function(e,t,n){},"browser/build/stitch":function(e,t,n){var r=t("stitch"),i=t("fs"),s=t("path"),o=r.createPackage({rootModuleName:"scion",paths:["lib"],excludes:[s.join("lib","node"),s.join("lib","rhino"),s.join("lib","browser","build"),s.join("lib","external")]}),u=process.argv[2];o.compile(function(e,t){i.writeFile(u,t,function(e){if(e)throw e;console.log("Compiled",u)})})},"browser/dom":function(e,t,n){"use strict";function i(e,t){return"item"in e?e.item(t):e[t]}var r=t("../base-platform/dom"),s=Object.create(r);s.hasAttribute=function(e,t){return e.hasAttribute?e.hasAttribute(t):e.getAttribute(t)},s.localName=function(e){return e.localName||e.tagName},s.createElementNS=function(e,t,n){return e.createElementNS?e.createElementNS(t,n):e.createElement(n)},s.getChildren=function(e){var t=[];for(var n=0;n<e.childNodes.length;n++)t.push(i(e.childNodes,n));return t},s.serializeToString=function(e){return e.xml||(new XMLSerializer).serializeToString(e)},n.exports=s},"browser/platform":function(e,t,n){"use strict";var r=t("../core/util/util");e.platform={ajax:window.jQuery,eval:t("../base-platform/eval"),getDocumentFromUrl:function(e,t,n){this.ajax.get(e,function(e){t(null,e)},"xml").error(function(e){t(e)})},parseDocumentFromString:function(e){return(new window.DOMParser).parseFromString(e,"application/xml")},getDocumentFromFilesystem:function(e,t,n){this.getDocumentFromUrl(e,t,n)},getResourceFromUrl:function(e,t,n){this.ajax.get(e,function(e){t(null,e)}).error(function(e){t(e)})},postDataToUrl:function(e,t,n){this.ajax.post(e,t,function(e){n(null,e)}).error(function(e){n(e)})},setTimeout:function(e,t){return window.setTimeout(e,t)},clearTimeout:function(e){window.clearTimeout(e)},log:window.console&&window.console.log&&(window.console.log.bind?window.console.log.bind(window.console):window.console.log),path:t("../base-platform/path"),url:t("./url"),dom:t("./dom")}},"browser/url":function(e,t,n){"use strict";function r(e){var t=document.createElement("a");return t.href=e,t}n.exports={getPathFromUrl:function(e){var t=r(e);return t.pathname},changeUrlPath:function(e,t){var n=r(e);return n.protocol+"//"+n.hostname+":"+n.port+t}}},"core/constants":function(e,t,n){"use strict";n.exports={SCXML_NS:"http://www.w3.org/2005/07/scxml"}},"core/scxml/SCXML":function(e,t,n){"use strict";function a(e){return function(e){var t=e[0],n=e[1];return t.source.depth<n.source.depth?n:n.source.depth<t.source.depth?t:t.documentOrder<n.documentOrder?t:n}}function l(e,t){this.model=e,this.opts=t,this.opts.log=this.opts.log||u.platform.log,this.opts.StateIdSet=this.opts.StateIdSet||r,this.opts.EventSet=this.opts.EventSet||r,this.opts.TransitionPairSet=this.opts.TransitionPairSet||r,this.opts.priorityComparisonFn=this.opts.priorityComparisonFn||a(this.opts.model),this._sessionid=this.opts.sessionid||"",this._configuration=new this.opts.BasicStateSet,this._historyValue={},this._innerEventQueue=[],this._isInFinalState=!1,this._timeoutMap={},this._listeners=[]}function c(e,t){t=t||{},s(t),this._isStepping=!1,this._send=t.send||this._send,this._cancel=t.cancel||this._cancel,l.call(this,e,t)}var r=t("./set/ArraySet"),i=t("./state-kinds-enum"),s=t("./setup-default-opts"),o=t("./scxml-dynamic-name-match-transition-selector"),u=t("../../platform"),f=!1;l.prototype={start:function(){f&&u.platform.log("performing initial big step"),this._configuration.add(this.model.root.initial);var e=this.opts.require||n.parent&&n.parent.parent&&n.parent.parent.require&&n.parent.parent.require.bind(n.parent.parent)||t.main&&t.main.require&&t.main.require.bind(t.main)||t,r=this.model.actionFactory(this.opts.log,this._cancel.bind(this),this._send.bind(this),this.opts.origin,this.isIn.bind(this),e,u.platform.parseDocumentFromString,this._sessionid);return this._actions=r.actions,this._datamodel=r.datamodel,this._performBigStep(),this.getConfiguration()},_getOrSetData:function(e,t,n){var r=this._datamodel[t];if(!r)throw new Error("Variable "+t+" not declared in datamodel.");return r[e](n)},_getData:function(e){return this._getOrSetData("get",e)},_setData:function(e,t){return this._getOrSetData("set",e,t)},getConfiguration:function(){return this._configuration.iter().map(function(e){return e.id})},getFullConfiguration:function(){return this._configuration.iter().map(function(e){return[e].concat(this.opts.model.getAncestors(e))},this).reduce(function(e,t){return e.concat(t)},[]).map(function(e){return e.id}).reduce(function(e,t){return e.indexOf(t)>-1?e:e.concat(t)},[])},isIn:function(e){return this.getFullConfiguration().indexOf(e)>-1},isFinal:function(e){return this._isInFinalState},_performBigStep:function(e){e&&this._innerEventQueue.push(new this.opts.EventSet([e]));var t=!0;while(t){var n=this._innerEventQueue.length?this._innerEventQueue.shift():new this.opts.EventSet,r={},s=this._performSmallStep(n,r);t=!s.isEmpty()}this._listeners.forEach(function(e){e.onBigStepComplete&&e.onBigStepComplete()}),this._isInFinalState=this._configuration.iter().every(function(e){return e.kind===i.FINAL})},_performSmallStep:function(e,t){f&&u.platform.log("selecting transitions with eventSet: ",e);var n=this._selectTransitions(e,t);f&&u.platform.log("selected transitions: ",n);if(!n.isEmpty()){f&&u.platform.log("sorted transitions: ",console.log(n));var r=new this.opts.TransitionSet(n.iter().filter(function(e){return e.targets})),s=this._getStatesExited(r),o=s[0],a=s[1],l=this._getStatesEntered(r),c=l[0],h=l[1];f&&u.platform.log("basicStatesExited ",o),f&&u.platform.log("basicStatesEntered ",c),f&&u.platform.log("statesExited ",a),f&&u.platform.log("statesEntered ",h);var p=new this.opts.EventSet;f&&u.platform.log("executing state exit actions"),a.forEach(function(n){(f||this.opts.logStatesEnteredAndExited)&&u.platform.log("exiting ",n.id),this._listeners.forEach(function(e){e.onExit&&e.onExit(n.id)}),n.onexit!==undefined&&this._evaluateAction(n.onexit,e,t,p);var r;n.history&&(n.history.isDeep?r=function(e){return e.kind===i.BASIC&&n.descendants.indexOf(e)>-1}:r=function(e){return e.parent===n},this._historyValue[n.history.id]=a.filter(r))},this);var d=n.iter().sort(function(e,t){return e.documentOrder-t.documentOrder});f&&u.platform.log("executing transitition actions"),d.forEach(function(n){var r=n.targets&&n.targets.map(function(e){return e.id});this._listeners.forEach(function(e){e.onTransition&&e.onTransition(n.source.id,r)}),n.actions!==undefined&&this._evaluateAction(n.actions,e,t,p)},this),f&&u.platform.log("executing state enter actions"),h.forEach(function(n){(f||this.opts.logStatesEnteredAndExited)&&u.platform.log("entering",n.id),this._listeners.forEach(function(e){e.onEntry&&e.onEntry(n.id)}),n.onentry!==undefined&&this._evaluateAction(n.onentry,e,t,p)},this),f&&u.platform.log("updating configuration "),f&&u.platform.log("old configuration ",this._configuration),this._configuration.difference(o),this._configuration.union(c),f&&u.platform.log("new configuration ",this._configuration),p.isEmpty()||(f&&u.platform.log("adding triggered events to inner queue ",p),this._innerEventQueue.push(p)),f&&u.platform.log("updating datamodel for next small step :");for(var v in t)this._setData(v,t[v])}return n},_evaluateAction:function(e,t,n,r){function i(e){r.add(e)}var s=this._getScriptingInterface(n,t,!0);return this._actions[e].call(this.opts.evaluationContext,s.getData,s.setData,s.events,i)},_getScriptingInterface:function(e,t,n){return{setData:n?function(t,n){return e[t]=n}:function(){},getData:this._getData.bind(this),events:t.iter()}},_getStatesExited:function(e){var t=new this.opts.StateSet,n=new this.opts.BasicStateSet;e.iter().forEach(function(e){var r=e.scope,i=r.descendants;this._configuration.iter().forEach(function(e){i.indexOf(e)>-1&&(n.add(e),t.add(e),this.opts.model.getAncestors(e,r).forEach(function(e){t.add(e)}))},this)},this);var r=t.iter().sort(function(e,t){return t.depth-e.depth});return[n,r]},_getStatesEntered:function(e){var t={statesToEnter:new this.opts.StateSet,basicStatesToEnter:new this.opts.BasicStateSet,statesProcessed:new this.opts.StateSet,statesToProcess:[]};e.iter().forEach(function(e){e.targets.forEach(function(n){this._addStateAndAncestors(n,e.scope,t)},this)},this);var n;while(n=t.statesToProcess.pop())this._addStateAndDescendants(n,t);var r=t.statesToEnter.iter().sort(function(e,t){return e.depth-t.depth});return[t.basicStatesToEnter,r]},_addStateAndAncestors:function(e,t,n){this._addStateAndDescendants(e,n),this.opts.model.getAncestors(e,t).forEach(function(e){e.kind===i.COMPOSITE?(n.statesToEnter.add(e),n.statesProcessed.add(e)):this._addStateAndDescendants(e,n)},this)},_addStateAndDescendants:function(e,t){if(t.statesProcessed.contains(e))return;e.kind===i.HISTORY?e.id in this._historyValue?this._historyValue[e.id].forEach(function(n){this._addStateAndAncestors(n,e.parent,t)},this):(t.statesToEnter.add(e),t.basicStatesToEnter.add(e)):(t.statesToEnter.add(e),e.kind===i.PARALLEL?t.statesToProcess.push.apply(t.statesToProcess,e.children.filter(function(e){return e.kind!==i.HISTORY})):e.kind===i.COMPOSITE?t.statesToProcess.push(e.initial):(e.kind===i.INITIAL||e.kind===i.BASIC||e.kind===i.FINAL)&&t.basicStatesToEnter.add(e)),t.statesProcessed.add(e)},_selectTransitions:function(e,t){if(this.opts.onlySelectFromBasicStates)var n=this._configuration.iter();else{var r=new this.opts.StateSet;this._configuration.iter().forEach(function(e){r.add(e),this.opts.model.getAncestors(e).forEach(function(e){r.add(e)})},this),n=r.iter()}var i=this._getScriptingInterface(t,e),s=function(e){return this._actions[e.conditionActionRef].call(this.opts.evaluationContext,i.getData,i.setData,i.events)}.bind(this),a=e.iter().map(function(e){return e.name}),l=a.filter(function(e){return e.search(".")}).length,c=l?o:this.opts.transitionSelector,h=new this.opts.TransitionSet;n.forEach(function(e){c(e,a,s).forEach(function(e){h.add(e)})});var p=this._selectPriorityEnabledTransitions(h);return f&&u.platform.log("priorityEnabledTransitions",p),p},_selectPriorityEnabledTransitions:function(e){var t=new this.opts.TransitionSet,n=this._getInconsistentTransitions(e),r=n[0],i=n[1];t.union(r),f&&u.platform.log("enabledTransitions",e),f&&u.platform.log("consistentTransitions",r),f&&u.platform.log("inconsistentTransitionsPairs",i),f&&u.platform.log("priorityEnabledTransitions",t);while(!i.isEmpty())e=new this.opts.TransitionSet(i.iter().map(function(e){return this.opts.priorityComparisonFn(e)},this)),n=this._getInconsistentTransitions(e),r=n[0],i=n[1],t.union(r),f&&u.platform.log("enabledTransitions",e),f&&u.platform.log("consistentTransitions",r),f&&u.platform.log("inconsistentTransitionsPairs",i),f&&u.platform.log("priorityEnabledTransitions",t);return t},_getInconsistentTransitions:function(e){var t=new this.opts.TransitionSet,n=new this.opts.TransitionPairSet,r=e.iter();f&&u.platform.log("transitions",r);for(var i=0;i<r.length;i++)for(var s=i+1;s<r.length;s++){var o=r[i],a=r[s];this._conflicts(o,a)&&(t.add(o),t.add(a),n.add([o,a]))}var l=e.difference(t);return[l,n]},_conflicts:function(e,t){return!this._isArenaOrthogonal(e,t)},_isArenaOrthogonal:function(e,t){var n=this.opts.model.isOrthogonalTo(e.scope,t.scope);return f&&(u.platform.log("transition scopes",e.scope.id,e.scope.id),u.platform.log("transition scopes are orthogonal?",n)),n},registerListener:function(e){return this._listeners.push(e)},unregisterListener:function(e){var t,n=this._listeners.indexOf(e);return n>=0&&(t=this._listeners.splice(n,1)),t}},c.prototype=Object.create(l.prototype),c.prototype.gen=function(e,t){var n;switch(typeof e){case"string":n={name:e,data:t};break;case"object":if(typeof e.name!="string")throw new Error('Event object must have "name" property of type string.');n=e;break;default:throw new Error("First argument to gen must be a string or object.")}if(this._isStepping)throw new Error("gen called before previous call to gen could complete. If executed in single-threaded environment, this means it was called recursively, which is illegal, as it would break SCION step semantics.");return this._isStepping=!0,this._performBigStep(n),this._isStepping=!1,this.getConfiguration()},c.prototype._send=function(e,t){var n,r,i=this;if(!u.platform.setTimeout)throw new Error("setTimeout function not set");f&&u.platform.log("sending event",e.name,"with content",e.data,"after delay",t.delay),n=function(){return i.gen(e)},r=u.platform.setTimeout(n,t.delay);if(t.sendid)return this._timeoutMap[t.sendid]=r},c.prototype._cancel=function(e){if(!u.platform.clearTimeout)throw new Error("clearTimeout function not set");if(e in this._timeoutMap)return f&&u.platform.log("cancelling ",e," with timeout id ",this._timeoutMap[e]),u.platform.clearTimeout(this._timeoutMap[e])},n.exports={SCXMLInterpreter:l,SimpleInterpreter:c}},"core/scxml/default-transition-selector":function(e,t,n){"use strict";n.exports=function(e,t,n){return e.transitions.filter(function(e){return!e.event||t.indexOf(e.event)>-1&&(!e.cond||n(e))})}},"core/scxml/json2model":function(e,t,n){"use strict";function s(e){function t(e,t){return r.push(i.gen.util.wrapFunctionBodyInDeclaration(e,t))-1}function n(e){return s[e]}var r=[],s={};e.states.forEach(function(e){s[e.id]=e}),e.transitions.forEach(function(e){e.cond&&(e.conditionActionRef=t(e.cond,!0))}),e.states.forEach(function(r){r.transitions=r.transitions.map(function(t){return e.transitions[t]});var i=[];r.onentry&&(r.onentry=t(r.onentry)),r.onexit&&(r.onexit=t(r.onexit)),r.transitions.forEach(function(e){e.actions&&(e.actions=t(e.actions)),e.lcca&&(e.lcca=s[e.lcca]),e.scope=s[e.scope]}),r.initial=s[r.initial],r.history=s[r.history],r.children=r.children.map(n),r.parent=s[r.parent],r.ancestors&&(r.ancestors=r.ancestors.map(n)),r.descendants&&(r.descendants=r.descendants.map(n)),r.transitions.forEach(function(e){e.source=s[e.source],e.targets=e.targets&&e.targets.map(n)})}),e.root=s[e.root];var o=i.gen.util.makeActionFactory(e.scripts,r,e.datamodel);return o}function o(e,t){var n=s(e);try{e.actionFactory=r.platform.eval(n,t)}catch(i){throw r.platform.log("Failed to evaluate action factory."),r.platform.log("Generated js code to evaluate\n",n),i}}var r=t("../../platform"),i=t("../util/code-gen");n.exports=function(e,t){return o(e,t),e};if(t.main===n){var u=process.argv[2],a=function(e,t){if(e)throw e;process.stdout.write(s(JSON.parse(t)))};if(u==="-"){var f="";process.stdin.resume(),process.stdin.on("data",function(e){f+=e}),process.stdin.on("end",function(e){a(null,f)})}else{var l=t("fs");l.readFile(u,"utf8",a)}}},"core/scxml/model":function(e,t,n){"use strict";var r=t("./state-kinds-enum"),i={getAncestors:function(e,t){var n,r,i;return r=e.ancestors.indexOf(t),r>-1?e.ancestors.slice(0,r):e.ancestors},getAncestorsOrSelf:function(e,t){return[e].concat(this.getAncestors(e,t))},getDescendantsOrSelf:function(e){return[e].concat(e.descendants)},isOrthogonalTo:function(e,t){return!this.isAncestrallyRelatedTo(e,t)&&this.getLCA(e,t).kind===r.PARALLEL},isAncestrallyRelatedTo:function(e,t){return this.getAncestorsOrSelf(t).indexOf(e)>-1||this.getAncestorsOrSelf(e).indexOf(t)>-1},getLCA:function(e,t){var n=this.getAncestors(e).filter(function(e){return e.descendants.indexOf(t)>-1},this);return n[0]}};n.exports=i},"core/scxml/scxml-dynamic-name-match-transition-selector":function(e,t,n){"use strict";function i(e){return new RegExp("^"+e.replace(/\./g,"\\.")+"(\\.[0-9a-zA-Z]+)*$")}function s(e){return r[e]?r[e]:r[e]=i(e)}function o(e,t){var n=e.events,r=n.indexOf("*")>-1?function(){return!0}:function(e){return n.filter(function(t){return s(t).test(e)}).length};return t.filter(r).length}var r={};n.exports=function(e,t,n){return e.transitions.filter(function(e){return(!e.events||o(e,t))&&(!e.cond||n(e))})}},"core/scxml/set/ArraySet":function(e,t,n){"use strict";function r(e){e=e||[],this.o=[],e.forEach(function(e){this.add(e)},this)}r.prototype={add:function(e){if(!this.contains(e))return this.o.push(e)},remove:function(e){var t=this.o.indexOf(e);return t===-1?!1:(this.o.splice(t,1),!0)},union:function(e){return e=e.iter?e.iter():e,e.forEach(function(e){this.add(e)},this),this},difference:function(e){return e=e.iter?e.iter():e,e.forEach(function(e){this.remove(e)},this),this},contains:function(e){return this.o.indexOf(e)>-1},iter:function(){return this.o},isEmpty:function(){return!this.o.length},equals:function(e){var t=e.iter(),n=this.o;return n.every(function(e){return t.indexOf(e)>-1})&&t.every(function(e){return n.indexOf(e)>-1})},toString:function(){return"Set("+this.o.toString()+")"}},n.exports=r},"core/scxml/setup-default-opts":function(e,t,n){"use strict";var r=t("./scxml-dynamic-name-match-transition-selector"),i=t("./set/ArraySet"),s=t("./model");n.exports=function(e){return e=e||{},e.TransitionSet=e.TransitionSet||i,e.StateSet=e.StateSet||i,e.BasicStateSet=e.BasicStateSet||i,e.transitionSelector=e.transitionSelector||r,e.model=e.model||s,e}},"core/scxml/state-kinds-enum":function(e,t,n){"use strict";n.exports={BASIC:0,COMPOSITE:1,PARALLEL:2,HISTORY:3,INITIAL:4,FINAL:5}},"core/util/annotate-scxml-json":function(e,t,n){"use strict";function b(e){return s.platform.dom.getChildren(e).filter(function(e){return s.platform.dom.localName(e)==="script"}).map(function(e){return s.platform.dom.textContent(e)})}function w(e){var t,n,r;n=0,r={};for(t in e)r[t]={name:t,documentOrder:n++};return r}function S(e,t){if(s.platform.dom.hasAttribute(e,"event")){var n,i=s.platform.dom.getAttribute(e,"event");i==="*"?n=[i]:n=i.trim().split(/\s+/).map(function(e){var t=e.match(E);if(t){var n=t[1];if(!t||!n)throw new Error("Unable to parse event: "+e);return n}}),n.filter(function(e){return e!=="*"}).forEach(function(e){c[e]=!0});if(n.indexOf(undefined)>-1)throw new Error("Error parsing event attribute attributes.event")}var o={internal:s.platform.dom.getAttribute(e,"type")==="internal",documentOrder:h.length,id:h.length,source:t.id,cond:s.platform.dom.getAttribute(e,"cond"),events:n,targets:s.platform.dom.hasAttribute(e,"target")?s.platform.dom.getAttribute(e,"target").trim().split(/\s+/):null};return s.platform.dom.getElementChildren(e).length&&(o.actions=r.gen.parentToFnBody(e)),h.push(o),o}function x(e,t){function r(e,t){if(s.platform.dom.hasAttribute(e,"id")){var n,i=s.platform.dom.getAttribute(e,"id");if(s.platform.dom.hasAttribute(e,"expr"))n={content:s.platform.dom.getAttribute(e,"expr"),type:"expr"},t?v[t+"."+i]=n:v[i]=n;else{var o=s.platform.dom.getChildren(e).filter(function(e){return s.platform.dom.localName(e)==="data"});t?o.forEach(function(e){r(e,t+"."+i)}):o.forEach(function(e){r(e,i)})}}}var n=s.platform.dom.getChildren(e).filter(function(e){return s.platform.dom.localName(e)==="data"});n.forEach(function(e){r(e,"")})}function T(e,t){var n=s.platform.dom.hasAttribute(e,"id")?s.platform.dom.getAttribute(e,"id"):k(s.platform.dom.localName(e)),c;switch(s.platform.dom.localName(e)){case"state":s.platform.dom.getChildren(e).filter(function(e){return a.indexOf(s.platform.dom.localName(e))>-1}).length?c=o.COMPOSITE:c=o.BASIC;break;case"scxml":c=o.COMPOSITE;break;case"initial":c=o.INITIAL;break;case"parallel":c=o.PARALLEL;break;case"final":c=o.FINAL;break;case"history":c=o.HISTORY;break;default:}var h={id:n,kind:c,descendants:[]};p[n]=h,t.length&&(h.parent=t[t.length-1]),c===o.HISTORY&&(h.isDeep=s.platform.dom.getAttribute(e,"type")==="deep"?!0:!1),h.documentOrder=f.length,f.push(h);if(c===o.BASIC||c===o.INITIAL||c===o.HISTORY)h.basicDocumentOrder=l.length,l.push(h);h.depth=t.length,h.ancestors=t.slice(),t.forEach(function(e){p[e].descendants.push(h.id)});var d,v,g=[],y=[],b=t.concat(h.id),w=!1,E=null,N=function(e){var t=T(e,b);return h.initial=t.id,y.push(t),w=!0};s.platform.dom.getElementChildren(e).forEach(function(e){switch(s.platform.dom.localName(e)){case"transition":g.push(S(e,h));break;case"onentry":v=r.gen.parentToFnBody(e);break;case"onexit":d=r.gen.parentToFnBody(e);break;case"initial":if(!!w)throw new Error("Encountered duplicate initial states in state "+h.id);N(e);break;case"history":var t=T(e,b);h.history=t.id,y.push(t);break;case"datamodel":x(e,b);break;default:if(u.indexOf(s.platform.dom.localName(e))>-1){var n=T(e,b);E===null&&(E=n),y.push(n)}}});if(!w&&s.platform.dom.localName(e)!=="parallel"){var C=s.platform.dom.hasAttribute(e,"initial"),L=function(e){var t=s.platform.dom.createElementNS(m,i.SCXML_NS,"initial"),n=s.platform.dom.createElementNS(m,i.SCXML_NS,"transition");return s.platform.dom.setAttribute(n,"target",e),s.platform.dom.appendChild(t,n),N(t)};C?L(s.platform.dom.getAttribute(e,"initial")):E&&L(E.id)}return h.onexit=d,h.onentry=v,h.transitions=g.map(function(e){return e.documentOrder}),h.children=y.map(function(e){return e.id}),h}function k(e){return C[e]=C[e]||0,""+N+"-"+e+"-"+C[e]++}function L(e,t){var n,r,i;i=[],e.ancestors.forEach(function(e){r=p[e],r.kind===o.COMPOSITE&&r.descendants.indexOf(t.id)>-1&&i.push(e)});if(!i.length)throw new Error("Could not find LCCA for states.");return i[0]}function A(e){var t=p[e.source],n=e.internal&&t.parent&&e.targets&&e.targets.map(function(e){return p[e]}).every(function(e){return t.descendants.map(function(e){return p[e]}).indexOf(e)>-1});return e.targets?n?e.source:e.lcca:e.source}var r=t("./code-gen"),i=t("../constants"),s=t("../../platform"),o=t("../scxml/state-kinds-enum"),u=["state","parallel","history","final","initial"],a=u.concat("scxml"),f,l,c,h,p,d,v,m,g=e.transformAndSerialize=g=function(e){return JSON.stringify(y(e))},y=e.transform=function(e){m=e;var t=m.documentElement;f=[],l=[],c={},h=[],p={},d=[],v={};var n=T(t,[]);return f.forEach(function(e){e.ancestors.reverse()}),f.forEach(function(e){e.descendants.reverse()}),h.filter(function(e){return e.targets}).forEach(function(e){var t=p[e.source],n=e.targets.map(function(e){var t=p[e];if(!t)throw new Error("Transition targets state id '"+e+"' but state does not exist.");return t});e.lcca=L(t,n[0])}),h.forEach(function(e){e.scope=A(e)}),{states:f,transitions:h,root:n.id,events:w(c),scripts:b(t),profile:s.platform.dom.getAttribute(t,"profile"),version:s.platform.dom.getAttribute(t,"version"),datamodel:v}},E=/^((([^.]+)\.)*([^.]+))(\.\*)?$/,N="$generated",C={};t.main===n&&console.log(JSON.stringify(y((new(t("xmldom").DOMParser)).parseFromString(t("fs").readFileSync(process.argv[2],"utf8"))),4,4))},"core/util/code-gen":function(e,t,n){"use strict";function s(e){return r.platform.dom.getElementChildren(e).map(o).join("\n;;\n")}function o(e){var t=u[r.platform.dom.namespaceURI(e)],n=t&&t[r.platform.dom.localName(e)];if(!t||!n)throw new Error("Element "+r.platform.dom.namespaceURI(e)+":"+r.platform.dom.localName(e)+" not yet supported");return n(e)}function a(e){return e?e.slice(-2)==="ms"?parseFloat(e.slice(0,-2)):e.slice(-1)==="s"?parseFloat(e.slice(0,-1))*1e3:parseFloat(e):0}function f(e,t){var n=e;if(t){n+=" = ";switch(t.type){case"xml":n+="$parseXml("+JSON.stringify(t.content)+")";break;case"json":n+="JSON.parse("+JSON.stringify(t.content)+")";break;case"expr":n+=t.content;break;default:n+=JSON.stringify(t.content)}}return n}function l(e){var t="var ",n=[];for(var r in e){var i=e[r];n.push(f(r,i))}return n.length?t+n.join(", ")+";":""}function c(e){var t=[];for(var n in e)t.push('"'+n+'" : {\n'+'"set" : function(v){ return '+n+" = v; },\n"+'"get" : function(){ return '+n+";}"+"\n}");return"{\n"+t.join(",\n")+"\n}"}function h(e,t){return"function(getData,setData,_events,$raise){var _event = _events[0];\n"+(t?"return":"")+" "+e+"\n}"}function p(e,t,n,r){return e+(t.length?t.join("\n"):"")+"var $datamodel = "+n+";\n"+"return {\n"+"datamodel:$datamodel,\n"+"actions:[\n"+r.join(",\n")+"\n]"+"\n};"}function d(e){return"function($log,$cancel,$send,$origin,In,require,$parseXml,_sessionid,_ioprocessors,_x){\n"+e+"\n}"}function v(e,t,n){var r=l(n),i=c(n),s=a.toString()+"\n"+p(r,e,i,t),o=d(s);return o}function m(e){var t=r.platform.dom.hasAttribute(e,"namelist")?r.platform.dom.getAttribute(e,"namelist").trim().split(/ +/):null,n=r.platform.dom.getChildren(e).filter(function(e){return r.platform.dom.localName(e)==="param"}),i=r.platform.dom.getChildren(e).filter(function(e){return r.platform.dom.localName(e)==="content"});if(i.length)return i=i[0],r.platform.dom.getAttribute(i,"type")==="application/json"?r.platform.dom.textContent(i):JSON.stringify(r.platform.dom.textContent(i));if(r.platform.dom.hasAttribute(e,"contentexpr"))return r.platform.dom.getAttribute(e,"contentexpr");var s="{";return t&&t.forEach(function(e){s+='"'+e+'"'+":"+e+",\n"}),n.length&&n.map(function(e){return g(e)}).forEach(function(e){e.expr?s+='"'+e.name+'"'+":"+e.expr+",\n":e.location&&(s+='"'+e.name+'"'+":"+e.location+",\n")}),s+="}",s}function g(e){return{name:r.platform.dom.getAttribute(e,"name"),expr:r.platform.dom.getAttribute(e,"expr"),location:r.platform.dom.getAttribute(e,"location")}}var r=t("../../platform"),i=t("../constants"),u={"":{script:function(e){return r.platform.dom.textContent(e)},assign:function(e){return r.platform.dom.getAttribute(e,"location")+" = "+r.platform.dom.getAttribute(e,"expr")+";"},"if":function(e){var t="";t+="if("+r.platform.dom.getAttribute(e,"cond")+"){\n";var n=r.platform.dom.getElementChildren(e);for(var i=0;i<n.length;i++){var s=n[i];if(r.platform.dom.localName(s)==="elseif"||r.platform.dom.localName(s)==="else")break;t+=o(s)+"\n;;\n"}for(;i<n.length;i++){s=n[i];if(r.platform.dom.localName(s)==="elseif")t+="}else if("+r.platform.dom.getAttribute(s,"cond")+"){\n";else{if(r.platform.dom.localName(s)==="else"){t+="}";break}t+=o(s)+"\n;;\n"}}for(;i<n.length;i++)s=n[i],r.platform.dom.localName(s)==="else"?t+="else{\n":t+=o(s)+"\n;;\n";return t+="}",t},elseif:function(){throw new Error("Encountered unexpected elseif tag.")},"else":function(){throw new Error("Encountered unexpected else tag.")},log:function(e){var t=[];return r.platform.dom.hasAttribute(e,"label")&&t.push(JSON.stringify(r.platform.dom.getAttribute(e,"label"))),r.platform.dom.hasAttribute(e,"expr")&&t.push(r.platform.dom.getAttribute(e,"expr")),"$log("+t.join(",")+");"},raise:function(e){return"$raise({ name:"+JSON.stringify(r.platform.dom.getAttribute(e,"event"))+", data : {}});"},cancel:function(e){return"$cancel("+JSON.stringify(r.platform.dom.getAttribute(e,"sendid"))+");"},send:function(e){var t=r.platform.dom.hasAttribute(e,"targetexpr")?r.platform.dom.getAttribute(e,"targetexpr"):JSON.stringify(r.platform.dom.getAttribute(e,"target")),n="_scionTargetRef",i="var "+n+" = "+t+";\n",s="{\ntarget: "+n+",\n"+"name: "+(r.platform.dom.hasAttribute(e,"eventexpr")?r.platform.dom.getAttribute(e,"eventexpr"):JSON.stringify(r.platform.dom.getAttribute(e,"event")))+",\n"+"type: "+(r.platform.dom.hasAttribute(e,"typeexpr")?r.platform.dom.getAttribute(e,"typeexpr"):JSON.stringify(r.platform.dom.getAttribute(e,"type")))+",\n"+"data: "+m(e)+",\n"+"origin: $origin\n"+"}",o=i+"if("+n+" === '#_internal'){\n"+"$raise("+s+");\n"+"}else{\n"+"$send("+s+", {\n"+"delay: "+(r.platform.dom.hasAttribute(e,"delayexpr")?"getDelayInMs("+r.platform.dom.getAttribute(e,"delayexpr")+")":a(r.platform.dom.getAttribute(e,"delay")))+",\n"+"sendId: "+(r.platform.dom.hasAttribute(e,"idlocation")?r.platform.dom.getAttribute(e,"idlocation"):JSON.stringify(r.platform.dom.getAttribute(e,"id")))+"\n"+"}, $raise);"+"}";return o},foreach:function(e){var t=r.platform.dom.hasAttribute(e,"index"),n=r.platform.dom.getAttribute(e,"index")||"$i",i=r.platform.dom.getAttribute(e,"item"),s=r.platform.dom.getAttribute(e,"array"),u=r.platform.dom.getElementChildren(e).map(o).join("\n;;\n");return"(function(){\nif(Array.isArray("+s+")){\n"+s+".forEach(function("+i+","+n+"){\n"+u+"\n});\n"+"}else{\n"+"Object.keys("+s+").forEach(function("+n+"){\n"+i+" = "+s+"["+n+"];\n"+u+"\n});\n"+"}\n"+"})();"}}};u[i.SCXML_NS]=u[""],n.exports={gen:{parentToFnBody:s,actionTagToFnBody:o,actionTags:u,util:{makeDatamodelDeclaration:l,makeDatamodelClosures:c,wrapFunctionBodyInDeclaration:h,makeTopLevelFunctionBody:p,wrapTopLevelFunctionBodyInDeclaration:d,makeActionFactory:v}}}},"core/util/docToModel":function(e,t,n){"use strict";function o(e,t,n,r){s.platform.getResourceFromUrl?f(e,t,r,function(r){r?n(r.length===1?r[0].err:new Error("Script download errors : \n"+r.map(function(e){return e.url+": "+e.err.message}).join("\n"))):u(e,t,n)}):u(e,t,n)}function u(e,t,n){try{var s=r.transform(t),o=i(s,e);n(null,o)}catch(u){n(u)}}function a(e,t){var n;if(s.platform.url.resolve)n=s.platform.url.resolve(e,t);else{var r=s.platform.url.getPathFromUrl(e),i=s.platform.path.dirname(r),o=s.platform.path.join(i,t);n=s.platform.url.changeUrlPath(e,o)}return n}function f(e,t,n,r){var i=[],o=[],u=0;l(t.documentElement,i),i.length?i.forEach(function(t,f){var l=s.platform.dom.getAttribute(t,"src");e&&(l=a(e,l)),s.platform.getResourceFromUrl(l,function(e,n,a){e?(s.platform.log("Error downloading document "+l+" : "+e.message),o.push({url:l,err:e})):s.platform.dom.textContent(t,n),++u,u==i.length&&r(o.length?o:null)},n)}):r()}function l(e,t){(s.platform.dom.localName(e)==="script"||s.platform.dom.localName(e)==="data")&&s.platform.dom.hasAttribute(e,"src")&&t.push(e),s.platform.dom.getElementChildren(e).forEach(function(e){l(e,t)})}var r=t("./annotate-scxml-json"),i=t("../scxml/json2model"),s=t("../../platform");n.exports=o},"core/util/util":function(e,t,n){"use strict";n.exports={merge:function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}}},"node/dom":function(e,t,n){"use strict";n.exports=t("../base-platform/dom");var r=t("xmldom").XMLSerializer;n.exports.serializeToString=function(e){return(new r).serializeToString(e)}},"node/get":function(e,t,n){"use strict";function o(e,t){var n=i.parse(e);r.get(n,function(e){var n="";e.on("data",function(e){n+=e}),e.on("end",function(){e.statusCode===200?t(null,n):t(new Error("HTTP code "+e.statusCode+" : "+n))})}).on("error",function(e){t(e)})}function u(e,t,n){}function a(e,t,n){var r=i.parse(e);r.protocol==="http:"||e.protocol==="https:"?o(e,t):r.protocol?t(new Error("Unrecognized protocol")):s.readFile(e,"utf8",t)}var r=t("http"),i=t("url"),s=t("fs");n.exports={getResource:a,httpGet:o,httpPost:u}},"node/node-listener-client":function(e,t,n){"use strict";function i(e){this.options=e;var t=new r.Agent;t.maxSockets=1,this.defaultOptions={host:"localhost",port:"1337",agent:t}}function s(e){for(var t=1;t<arguments.length;t++)for(
var n in arguments[t]){var r=arguments[t][n];e[n]=r}}var r=t("http");i.prototype={onEntry:function(e){r.get(s({path:"/onEntry?id="+e},this.defaultOptions,this.options),function(e){})},onExit:function(e){r.get(s({path:"/onExit?id="+e},this.defaultOptions,this.options),function(e){})},onTransition:function(e,t){},onBigStepComplete:function(){}},n.exports=i},"node/node-scxml-gui-http-proxy-server":function(e,t,n){"use strict";var r=t("http"),i=t("url"),s=t("net"),o=process.argv.slice(2),u=o[0]||1337,a=o[1]||"localhost",f=parseInt(o[2],10)||9999,l=new s.Socket;l.connect(f,a,function(){}),l.on("error",function(e){console.log("Could not connect to service at host "+a+", port "+f),c&&c.close()}),l.on("data",function(e){console.log("received data from scxmlGUI socket",e)}),l.on("close",function(e){console.log("scxmlGUI socket closed unexpectedly"),c&&c.close()});var c=r.createServer(function(e,t){var n=i.parse(e.url,!0);switch(n.pathname){case"/onEntry":l.write("1 "+n.query.id+"\n");break;case"/onExit":l.write("0 "+n.query.id+"\n");break;case"/onTransition":break;default:t.writeHead(400,{"Content-Type":"text/plain"}),t.end("Unable to understand request\n");return}t.writeHead(200,{"Content-Type":"text/plain"}),t.end("Request processed\n")}).listen(u)},"node/platform":function(e,t,n){"use strict";function f(e){return(new r.DOMParser).parseFromString(e)}function l(e){return function(t,n){if(t)e(t);else try{var r=f(n);e(null,r)}catch(i){e(i)}}}var r=t("xmldom"),i=t("fs"),s=t("./get"),o=t("path"),u=t("./url"),a=t("vm");e.platform={getDocumentFromUrl:function(e,t){s.httpGet(e,l(t))},parseDocumentFromString:f,getDocumentFromFilesystem:function(e,t,n){i.readFile(e,"utf8",l(t))},getResourceFromUrl:s.getResource,postDataToUrl:function(e,t,n){},setTimeout:setTimeout,clearTimeout:clearTimeout,log:console.log,eval:function(e,t){function n(){var e={};for(var t in global)e[t]=global[t];return e}return a.runInNewContext("("+e+");",n(),t)},path:t("path"),url:u,dom:t("./dom")}},"node/url":function(e,t,n){"use strict";var r=t("url");n.exports={getPathFromUrl:function(e){var t=r.parse(e);return t.pathname},changeUrlPath:function(e,t){var n=r.parse(e);return n.path=n.pathname=t,r.format(n)},resolve:function(e,t){return r.resolve(e,t)}}},platform:function(e,t,n){"use strict";function r(){return typeof Packages!="undefined"}function i(){return typeof process!="undefined"&&typeof n!="undefined"}function s(){return typeof window!="undefined"&&typeof document!="undefined"}var o;s()?n.exports=t("./browser/platform"):i()?n.exports=t("./node/platform"):r()&&(n.exports=t("./rhino/platform"))},"rhino/dom":function(e,t,n){"use strict";var r=t("../base-platform/dom"),i=Object.create(r);i.getChildren=function(e){var t=[];for(var n=0;n<e.childNodes.length;n++)t.push(e.childNodes.item(n));return t},["localName","getAttribute","namespaceURI","textContent"].forEach(function(e){var t=r[e];i[e]=function(){return String(t.apply(this,arguments))}}),i.serializeToString=function(e){var t=new Packages.java.io.ByteArrayOutputStream,n=new Packages.org.apache.xml.serialize.XMLSerializer(t,new Packages.org.apache.xml.serialize.OutputFormat);n.asDOMSerializer().serialize(e);var r=String(new Packages.java.lang.String(t.toByteArray()));return r},n.exports=i},"rhino/get":function(e,t,n){"use strict";function r(e){var t=new Packages.java.net.URL(e),n=t.openConnection();n.setRequestMethod("GET");var r=new Packages.java.io.BufferedReader(new Packages.java.io.InputStreamReader(n.getInputStream())),i,s="";while(i=r.readLine())s+=i;return r.close(),s}function i(e,t,n){}function s(e){var t=new Packages.java.io.BufferedReader(new Packages.java.io.InputStreamReader(new Packages.java.io.DataInputStream(new Packages.java.io.FileInputStream(e)))),n="",r;while(r=t.readLine())n+=r;return t.close(),n}function o(e,t,n){try{if(e.match(/^http(s?):/)){var i=r(e);t(null,i)}else i=s(e),t(null,i)}catch(o){t(o)}}n.exports={httpGet:r,httpPost:i,readFile:s,getResource:o}},"rhino/path":function(e,t,n){"use strict";n.exports={join:function(e,t){return(new Packages.java.io.File(e,t)).path},dirname:function(e){return(new Packages.java.io.File(e)).parent},basename:function(e,t){var n=Packages.java.io.File(e).name;if(t){var r=this.extname(n);r[1]===t&&(n=r[1])}return n},extname:function(e){return e.split(/\\.(?=[^\\.]+$)/)[1]}}},"rhino/platform":function(e,t,n){"use strict";function u(){var e=Packages.javax.xml.parsers.DocumentBuilderFactory.newInstance();return e.setNamespaceAware(!0),e.newDocumentBuilder()}var r=t("./timeout"),i=t("./get"),s=t("./path"),o=t("./url");e.platform={getDocumentFromUrl:function(e,t,n){try{var r=u().parse(e);t(null,r)}catch(i){t(i)}},parseDocumentFromString:function(e){var t=u(),n=new Packages.org.xml.sax.InputSource;return n.setCharacterStream(new Packages.java.io.StringReader(e)),t.parse(n)},getDocumentFromFilesystem:function(e,t,n){this.getDocumentFromUrl(e,t,n)},getResourceFromUrl:i.getResource,postDataToUrl:function(e,t,n){},setTimeout:r.setTimeout,clearTimeout:r.clearTimeout,log:function(){for(var e=0;e<arguments.length;e++)Packages.java.lang.System.out.println(String(arguments[e]))},eval:function(e,t){var n=Packages.org.mozilla.javascript.ContextFactory.getGlobal().enterContext();return n.evaluateString(this,"("+e+")",t,0,null)},path:s,url:o,dom:t("./dom")}},"rhino/timeout":function(e,t,n){"use strict";(function(){function s(){i--,i===0&&(r=null)}var t=1,n={},r,i=0;e.setTimeout=function(e,o){var u=t++;i++,r||(r=new Packages.java.util.Timer);var a=new Packages.java.util.TimerTask({run:function(){s(),e()}});return r.schedule(a,o),n[u]=a,u},e.clearTimeout=function(e){var t=n[e];t.cancel(),r.purge(),delete n[e],s()}})()},"rhino/url":function(e,t,n){"use strict";n.exports={getPathFromUrl:function(e){var t=new Packages.java.net.URL(e);return t.path},changeUrlPath:function(e,t){var n=new Packages.java.net.URL(e);return String((new Packages.java.net.URL(n.protocol,n.host,n.port,t)).toString())},resolve:function(e,t){var n=new Packages.java.net.URL(new Packages.java.net.URL(e),t);return n.toString()}}},scion:function(e,t,n){"use strict";function o(e,t,n){if(!r.platform.getDocumentFromUrl)throw new Error("Platform does not support getDocumentFromUrl");r.platform.getDocumentFromUrl(e,function(r,i){r?t(r,null):s(e,i,t,n)},n)}function u(e,t,n){if(!r.platform.getDocumentFromFilesystem)throw new Error("Platform does not support getDocumentFromFilesystem");r.platform.getDocumentFromFilesystem(e,function(r,i){r?t(r,null):s(e,i,t,n)},n)}function a(e,t,n){if(!r.platform.parseDocumentFromString)throw new Error("Platform does not support parseDocumentFromString");s(null,r.platform.parseDocumentFromString(e),t,n)}var r=t("./platform"),i=t("./core/scxml/SCXML"),s=t("./core/util/docToModel"),f=n.exports={pathToModel:u,urlToModel:o,documentStringToModel:a,documentToModel:s,SCXML:i.SimpleInterpreter,ext:{platformModule:r,actionCodeGeneratorModule:t("./core/util/code-gen")}}}});